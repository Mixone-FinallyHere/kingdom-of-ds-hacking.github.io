<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Animation Bank (ABNK) - Kingdom of DS Hacking</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../favicon.png">
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../highlight.css">
        <link rel="stylesheet" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../../../index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">Guides</li><li class="chapter-item "><div>Generation IV</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Diamond and Pearl</div></li><li class="chapter-item "><div>Platinum</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../gen4/guides/field/pt_hgss-pokemarts.html">Adding New Poké Marts</a></li><li class="chapter-item "><a href="../../../../gen4/guides/field/pt_hgss-script_weather.html">Setting the Weather from a Script</a></li></ol></li><li class="chapter-item "><div>Heartgold and SoulSilver</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../gen4/guides/field/pt_hgss-pokemarts.html">Adding New Poké Marts</a></li><li class="chapter-item "><a href="../../../../gen4/guides/interface/hgss-town_map.html">Editing the Town Map</a></li><li class="chapter-item "><a href="../../../../gen4/guides/field/pt_hgss-script_weather.html">Setting the Weather from a Script</a></li></ol></li></ol></li><li class="chapter-item "><div>Generation V</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Black and White</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../gen5/guides/misc/bw_b2w2-code_injection.html">Code Injection</a></li></ol></li><li class="chapter-item "><div>Black 2 and White 2</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../gen5/guides/misc/bw_b2w2-code_injection.html">Code Injection</a></li><li class="chapter-item "><a href="../../../../gen5/guides/misc/b2w2-fairy.html">Fairy Type Insertion</a></li></ol></li></ol></li><li class="chapter-item "><div>Universal</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/guides/code_injection/code_injection.html">Code Injection</a></li><li class="chapter-item "><a href="../../../../universal/guides/sprite_indexing/indexing.html">Sprite Indexing</a></li><li class="chapter-item "><a href="../../../../universal/guides/ncer_sprite_editing/ncer_sprite_editing.html">NCER Sprite Editing</a></li></ol></li><li class="chapter-item "><li class="part-title">Resources</li><li class="chapter-item "><div>Generation IV</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Diamond and Pearl</div></li><li class="chapter-item "><div>Platinum</div></li><li class="chapter-item "><div>Heartgold and SoulSilver</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../gen4/resources/interface/hgss-town_map_spots.html">Town Map Structures</a></li></ol></li></ol></li><li class="chapter-item "><div>Generation V</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div>Black and White</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../gen5/resources/field/bw_b2w2-maps.html">Maps</a></li><li class="chapter-item "><a href="../../../../gen5/resources/field/bw_b2w2-zone_entities.html">Zone Entities</a></li></ol></li><li class="chapter-item "><div>Black 2 and White 2</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../gen5/resources/field/b2w2-area_data.html">Area Data</a></li><li class="chapter-item "><a href="../../../../gen5/resources/field/bw_b2w2-maps.html">Maps</a></li><li class="chapter-item "><a href="../../../../gen5/resources/field/bw_b2w2-zone_entities.html">Zone Entities</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../../universal/resources/nitro/nitro_overview.html">Nitro</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/file_system/file_narc.html">Nitro Archive (NARC)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/file_system/section_fatb.html">File Allocation Table (FATB)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/file_system/section_fntb.html">File Name Table (FNTB)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/file_system/section_fimg.html">File Image (FIMG)</a></li></ol></li><li class="chapter-item expanded "><div>G2D</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/file_nanr.html">Nitro Animation Runtime (NANR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_abnk.html" class="active">Animation Bank (ABNK)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_labl.html">Label (LABL)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_uext.html">User Extension (UEXT)</a></li></ol></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/file_nclr.html">Nitro Color Runtime (NCLR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_pltt.html">Palette (PLTT)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_pcmp.html">Palette Count Map (PCMP)</a></li></ol></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/file_ncer.html">Nitro Cell Runtime (NCER)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_cebk.html">Cell Bank (CEBK)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_labl.html">Label (LABL)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_uext.html">User Extension (UEXT)</a></li></ol></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/file_ncgr.html">Nitro Graphics Runtime (NCGR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_char.html">Character (CHAR)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_cpos.html">Character Position (CPOS)</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../universal/resources/nitro/graphics_2d/file_nmar.html">Nitro Multicell Animation Runtime (NMAR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../universal/resources/nitro/graphics_2d/section_abnk.html" class="active">Animation Bank (ABNK)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_labl.html">Label (LABL)</a></li></ol></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/file_nmcr.html">Nitro Multicell Runtime (NMCR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_mcbk.html">Multicell Bank (MCBK)</a></li></ol></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/file_nscr.html">Nitro Screen Runtime (NSCR)</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_2d/section_scrn.html">Screen (SCRN)</a></li></ol></li></ol></li><li class="chapter-item "><div>G3D</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_3d/file_bta0.html">Nitro System Binary Texture Animation (NSBTA)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_3d/file_bmd0.html">Nitro System Binary Model (NSBMD)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_3d/file_btx0.html">Nitro System Binary Texture (NSBTX)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_3d/file_btp0.html">Nitro System Binary Texture Pattern (NSBTP)</a></li><li class="chapter-item "><a href="../../../../universal/resources/nitro/graphics_3d/file_bca0.html">Nitro System Binary Character Skeleton Animation (NSBCA)</a></li></ol></li><li class="chapter-item "><div>Sound</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Kingdom of DS Hacking</h1>

                    <div class="right-buttons">
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="abnk-knba---animation-bank"><a class="header" href="#abnk-knba---animation-bank">ABNK (&quot;KNBA&quot;) - Animation Bank</a></h1>
<blockquote>
<p>Author(s): <a href="https://github.com/Gonhex">Gonhex</a> <br />
Research: <a href="https://problemkaputt.de">NOCASH</a>, <a href="https://github.com/magical">magical</a>, <a href="https://github.com/Gonhex">Gonhex</a></p>
</blockquote>
<pre class="mermaid">flowchart BT;
    NANR(N. Animation R.)--&gt;G2D(Graphics 2D);
    NMAR(N. Multi Animation R.)--&gt;G2D;
    ABNK(Animation Bank)--&gt;NANR;
    ABNK--&gt;NMAR;
</pre>
<p>The animation bank is used to animate 2D graphics. It requires an object to work on, which can be either a cell bank or a multi cell bank. Internally it works like frame by frame animations. To achieve more dynamic results, affine transformations can be applied to selected frames.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ul>
<li><a href="#data-structure">Data Structure</a>
<ul>
<li><a href="#section-container">Section Container</a></li>
<li><a href="#abnk-container">ABNK Container</a></li>
<li><a href="#sequence">Sequence</a></li>
<li><a href="#frame">Frame</a></li>
<li><a href="#frame-properties">FrameProperties</a></li>
</ul>
</li>
<li><a href="#specification">Specification</a>
<ul>
<li><a href="#animation">Animation</a></li>
<li><a href="#loop-mode">Loop Mode</a></li>
<li><a href="#affine-transformation">Affine Transformation</a></li>
<li><a href="#files">Files</a></li>
</ul>
</li>
<li><a href="#todo">TODO</a></li>
</ul>
<hr />
<h2 id="data-structure"><a class="header" href="#data-structure">Data Structure</a></h2>
<h3 id="section-container"><a class="header" href="#section-container">Section Container</a></h3>
<pre><code class="language-c">struct ContainerSectionABNK
{
    /* 0x0    */ struct NitroSectionHeader sectionHeader;
    /* 0x8    */ struct ContainerABNK sectionData;
}; // entry size = sectionHeader.lengthSection
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>sectionHeader</td><td>Header of this section. <code>sectionHeader.signature = &quot;KNBA&quot;</code>.</td><td><a href="../nitro_overview.html#nitro-section-header">NitroSectionHeader</a></td></tr>
<tr><td>sectionData</td><td>Content of this section.</td><td><a href="#abnk-container">ContainerABNK</a></td></tr>
</tbody></table>
</div>
<h3 id="abnk-container"><a class="header" href="#abnk-container">ABNK Container</a></h3>
<pre><code class="language-c">struct ContainerABNK
{
    // header
    /* 0x00 */ uint16_t numberSequences;
    /* 0x02 */ uint16_t numberFrames;
    /* 0x04 */ uint32_t offsetDataSequences;
    /* 0x08 */ uint32_t offsetDataFrame
    /* 0x0C */ uint32_t offsetDataFrameProperties;
    /* 0x10 */ uint32_t unknown0;
    /* 0x14 */ uint32_t unknown1;
    
    // data
    /* offsetDataSequences       */ struct Sequence dataSequences[numberSequences];
    /* offsetDataFrame           */ struct Frame dataFrames[numberFrames];
    /* offsetDataFrameProperties */ struct FrameProperties dataFrameProperties[?];
}; // entry size = sectionHeader.lengthSection - 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberSequences</td><td>Number of sequences.</td><td>uint16_t</td></tr>
<tr><td>numberFrames</td><td>Number of frames.</td><td>uint16_t</td></tr>
<tr><td>offsetDataSequences</td><td>Offset to the sequence data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>offsetDataFrame</td><td>Offset to the frame data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>offsetDataFrameProperties</td><td>Offset to the frame property data section relative to <code>ContainerABNK</code>.</td><td>uint32_t</td></tr>
<tr><td>unknown0</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>unknown1</td><td>Unused offset?</td><td>uint32_t</td></tr>
<tr><td>dataSequences</td><td>Animated object data.</td><td><a href="#sequence">Sequence[]</a></td></tr>
<tr><td>dataFrames</td><td>Frame configuration data. Duration in frames and an index to the properties.</td><td><a href="#frame">Frame[]</a></td></tr>
<tr><td>dataFrameProperties</td><td>Current (multi) cell index and affine transformation data, depends on the sequence.</td><td><a href="#frame-properties">FrameProperties[]</a></td></tr>
</tbody></table>
</div>
<h3 id="sequence"><a class="header" href="#sequence">Sequence</a></h3>
<pre><code class="language-c">struct Sequence
{
    /* 0x0 */ uint32_t numberFrames;
    /* 0x4 */ uint16_t animationType;
    /* 0x6 */ uint16_t cellType;
    /* 0x8 */ uint32_t loopMode;
    /* 0xC */ uint32_t offsetFrame;
}; // entry size = 0x10
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>numberFrames</td><td>Refers to the count of <a href="#frame">frame-blocks</a> used in this sequence.</td><td>uint32_t</td></tr>
<tr><td>animationType</td><td><code>0x0</code> = sequence, <code>0x1</code> = affine transform, <code>0x2</code> = translation.</td><td>uint16_t</td></tr>
<tr><td>cellType</td><td><code>0x1</code> = unique cell, <code>0x2</code> = multi cell.</td><td>uint16_t</td></tr>
<tr><td>loopMode</td><td>Behaviour of the frame sequence, values are documented in <a href="#loop-mode">Loop Mode</a>.</td><td>uint32_t</td></tr>
<tr><td>offsetFrame</td><td>Offset to the first used frame, relative to <code>offsetDataFrame</code>.</td><td>uint32_t</td></tr>
</tbody></table>
</div>
<h3 id="frame"><a class="header" href="#frame">Frame</a></h3>
<pre><code class="language-c">struct Frame
{
    /* 0x0 */ uint32_t offsetProperties;
    /* 0x4 */ uint16_t durationInFrames;
    /* 0x6 */ int16_t unknown0;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>offsetProperties</td><td>Offset to the first used frame property, relative to <code>offsetDataFrameProperties</code>.</td><td>uint32_t</td></tr>
<tr><td>durationInFrames</td><td>Number of frames remaining in this state, 60 frames per second.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Always <code>0xBEEF</code>.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<h3 id="frame-properties"><a class="header" href="#frame-properties">Frame Properties</a></h3>
<pre><code class="language-c">// if animationType == 0
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
}; // entry size = 0x2

// if animationType == 1
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
    /* 0x2 */ uint16_t rotate;
    /* 0x4 */ fx&lt;1.19.12&gt; scaleW;
    /* 0x8 */ fx&lt;1.19.12&gt; scaleH;
    /* 0xC */ int16_t translateX;
    /* 0xE */ int16_t translateY;
}; // entry size = 0x10

// if animationType == 2
struct FrameProperties
{
    /* 0x0 */ uint16_t cellIndex;
    /* 0x2 */ uint16_t unknown0;
    /* 0x4 */ int16_t translateX;
    /* 0x6 */ int16_t translateY;
}; // entry size = 0x8
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>Field Name</th><th>Description</th><th>Data Type</th></tr></thead><tbody>
<tr><td>cellIndex</td><td>Index of the displayed cell or multi cell block.</td><td>uint16_t</td></tr>
<tr><td>rotate</td><td>Rotation angle, using the full range of uint16_t for one turn.</td><td>uint16_t</td></tr>
<tr><td>unknown0</td><td>Unused, <code>0x0</code> or <code>0xBEEF</code>.</td><td>uint16_t</td></tr>
<tr><td>scaleW</td><td>Width scaling factor.</td><td><a href="">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>scaleH</td><td>Height scaling factor.</td><td><a href="">fx&lt;1.19.12&gt;</a></td></tr>
<tr><td>translateX</td><td>X position adjustment.</td><td>int16_t</td></tr>
<tr><td>translateY</td><td>Y position adjustment.</td><td>int16_t</td></tr>
</tbody></table>
</div>
<p><strong>Important:</strong> The structs for <code>animationType &gt; 0</code> must be DWORD aligned. If there is a region with an odd number of type-0 properties, a dummy entry is appended as padding.</p>
<hr />
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<h3 id="animation"><a class="header" href="#animation">Animation</a></h3>
<p>To animate a sprite, three data blocks are required.</p>
<ol>
<li>The entry point is the <a href="#sequence">sequence data</a>. This defines the gereral properties of a sequence. How many different frames are involved? Are transformations applied or does the animation only rely on changing images? This decision is applyed to all frames, which are part of the sequence.</li>
<li>The <a href="#frame">frame data</a> tells, how long the image remains in this state. On a 60 fps system, setting it to 60 frames (<code>0x3C</code>) makes it last one second before switching to the next frame. It also points to an offset in the frame property data. To save memory, multiple frames can point to the same property offset.</li>
<li>The structure of the <a href="#frame-properties">frame properties</a> depends on the <code>animationType</code> setting from the sequence data. If it is <code>== 0</code>, all it does is displaying the selected cell. If it is <code>== 2</code>, the position can also be changed. <code>animationType == 1</code> also adds scaling and rotation.</li>
</ol>
<p>If the animation is applied to a normal cell bank, the image in each frame is static, meaning if one frame is set to remain for one second and the transformation is rotate 180°, the image will be displayed upside down for one second. If the animation is applied to multi cells, which already have animated parts, it will loop through the animations of the multi cell, while &quot;being upside down&quot;.</p>
<h3 id="loop-mode"><a class="header" href="#loop-mode">Loop Mode</a></h3>
<p>The loop mode defines what to do, after the animation reached its last frame. There are four values, which can be used:</p>
<ol>
<li>Stop animation at last frame.</li>
<li>Repeat animation after last frame.</li>
<li>Play frames backwards after reaching the last frame and stop at first frame.</li>
<li>Ping pong mode, repeat alternately forward and backward.</li>
</ol>
<p>Other values are not supported and end up in the behavior of <code>1</code>.</p>
<h3 id="affine-transformation"><a class="header" href="#affine-transformation">Affine Transformation</a></h3>
<p>The transformation matrices are applied in the following order:</p>
<ol>
<li>Scaling</li>
</ol>
<p>$$
\begin{bmatrix}
\textbf{scaleW} &amp; 0               &amp; 0 \
0               &amp; \textbf{scaleH} &amp; 0 \
0               &amp; 0               &amp; 1 \
\end{bmatrix}
$$</p>
<ol start="2">
<li>Rotatating (adjust <code>rotate</code> first)</li>
</ol>
<p>$$
\begin{bmatrix}
cos(\textbf{rotate}) &amp; -sin(\textbf{rotate}) &amp; 0 \
sin(\textbf{rotate}) &amp; cos(\textbf{rotate})  &amp; 0 \
0                    &amp; 0                     &amp; 1 \
\end{bmatrix}
$$</p>
<ol start="3">
<li>Translating</li>
</ol>
<p>$$
\begin{bmatrix}
1 &amp; 0 &amp; \textbf{translateX} \
0 &amp; 1 &amp; \textbf{translateY} \
0 &amp; 0 &amp; 1                   \
\end{bmatrix}
$$</p>
<h3 id="files"><a class="header" href="#files">Files</a></h3>
<ul>
<li><a href="file_nanr.html">Nitro Animation Runtime</a></li>
<li><a href="file_nmar.html">Nitro Multi Animation Runtime</a></li>
</ul>
<hr />
<h2 id="todo"><a class="header" href="#todo">TODO</a></h2>
<ul>
<li>Link fixed point definition</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../universal/resources/nitro/graphics_2d/file_nanr.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../../universal/resources/nitro/graphics_2d/section_labl.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../universal/resources/nitro/graphics_2d/file_nanr.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../../universal/resources/nitro/graphics_2d/section_labl.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../elasticlunr.min.js"></script>
        <script src="../../../../mark.min.js"></script>
        <script src="../../../../searcher.js"></script>

        <script src="../../../../clipboard.min.js"></script>
        <script src="../../../../highlight.js"></script>
        <script src="../../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
